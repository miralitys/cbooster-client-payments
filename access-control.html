<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Access Control</title>
    <link rel="stylesheet" href="/styles.css?v=20260219-access-user-edit-modal-v3" />
    <script src="/access-control.js?v=20260219-access-user-edit-modal-v3" defer></script>
  </head>
  <body>
    <main class="page-shell" aria-busy="false">
      <div class="container access-control-page">
        <header class="section page-header access-control-page-header">
          <div class="page-header__title">
            <p class="eyebrow">Credit Booster</p>
            <h1>Access Control</h1>
            <p class="access-control-subtitle">
              Global authorization model with departments, roles, and permissions.
            </p>
          </div>

          <div class="page-header__right access-control-page-header__actions">
            <button id="access-control-add-user-button" type="button" class="btn btn-primary" hidden>
              Add New User
            </button>
            <div id="account-menu" class="account-menu">
              <button
                id="account-menu-toggle"
                type="button"
                class="account-menu__toggle"
                aria-haspopup="menu"
                aria-expanded="false"
                aria-controls="account-menu-panel"
                aria-label="Open account menu"
              >
                <span class="account-menu__line" aria-hidden="true"></span>
                <span class="account-menu__line" aria-hidden="true"></span>
                <span class="account-menu__line" aria-hidden="true"></span>
              </button>

              <div id="account-menu-panel" class="account-menu__panel" role="menu" hidden>
                <a href="/" class="account-menu__item" role="menuitem">Main</a>
                <a href="/quickbooks-payments" class="account-menu__item" role="menuitem">Quick Book Payment</a>
                <a href="/Client_Payments" class="account-menu__item" role="menuitem">Client Payment</a>
                <a href="/client-managers" class="account-menu__item" role="menuitem">Client - Manager Test</a>
                <a href="/access-control" class="account-menu__item" role="menuitem">Access Control</a>
                <div class="account-menu__divider" aria-hidden="true"></div>
                <p id="account-menu-user" class="account-menu__user">User: -</p>
                <button id="account-logout-action" type="button" class="account-menu__item" role="menuitem">
                  Log Out
                </button>
              </div>
            </div>
          </div>
        </header>

        <section class="section access-control-current-user-panel" aria-live="polite">
          <h2 class="section-heading">Current Access</h2>
          <p id="access-control-status" class="dashboard-message access-control-status">Loading access model...</p>
          <div id="access-control-current-user" class="access-control-current-user"></div>
        </section>

        <section
          id="access-control-registration-panel"
          class="section access-control-registration-panel user-registration-form-panel"
          aria-live="polite"
          hidden
        >
          <div class="access-control-registration-panel__header">
            <h2 class="section-heading">User Registration</h2>
            <button id="access-control-close-user-form-button" type="button" class="btn btn-secondary">Close</button>
          </div>

          <p id="access-control-registration-status" class="dashboard-message user-registration-status">
            Fill out the form to create a new user. Username and password are optional.
          </p>

          <form id="access-control-registration-form" class="user-registration-form" novalidate>
            <label class="user-registration-field">
              <span>Username / Email (optional)</span>
              <input
                id="access-control-new-user-username"
                name="username"
                type="text"
                autocomplete="off"
                placeholder="Optional: user email or login"
              />
            </label>

            <label class="user-registration-field">
              <span>Password (optional)</span>
              <input
                id="access-control-new-user-password"
                name="password"
                type="password"
                autocomplete="new-password"
                placeholder="Optional: at least 8 characters"
              />
            </label>

            <label class="user-registration-field">
              <span>Display Name</span>
              <input
                id="access-control-new-user-display-name"
                name="displayName"
                type="text"
                maxlength="140"
                autocomplete="off"
                required
                placeholder="Required"
              />
            </label>

            <label class="user-registration-field">
              <span>Department</span>
              <select id="access-control-new-user-department" name="departmentId" required>
                <option value="accounting">Accounting Department</option>
                <option value="client_service">Client Service Department</option>
                <option value="sales">Sales Department</option>
                <option value="collection">Collection Department</option>
              </select>
            </label>

            <label class="user-registration-field">
              <span>Role</span>
              <select id="access-control-new-user-role" name="roleId" required></select>
            </label>

            <label
              class="user-registration-field user-registration-field--wide"
              id="access-control-new-user-team-field"
              hidden
            >
              <span>Team Usernames (comma separated, for Middle Manager)</span>
              <input id="access-control-new-user-team" name="teamUsernames" type="text" autocomplete="off" />
            </label>

            <button id="access-control-create-user-button" type="submit" class="btn btn-primary">Create User</button>
          </form>

          <h3 class="subsection-heading">Current Users</h3>

          <div class="table-wrap user-registration-users-wrap">
            <table class="user-registration-users-table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Display Name</th>
                  <th>Role</th>
                  <th>Department</th>
                  <th>Owner</th>
                </tr>
              </thead>
              <tbody id="access-control-users-body"></tbody>
            </table>
          </div>
        </section>

        <section class="section access-control-departments-panel" aria-live="polite">
          <h2 class="section-heading">Departments</h2>
          <div id="access-control-departments" class="access-control-departments"></div>
        </section>
      </div>
    </main>

    <div id="access-control-edit-user-modal" class="modal" hidden>
      <button
        id="access-control-edit-user-backdrop"
        type="button"
        class="modal-backdrop"
        aria-label="Close edit user dialog"
      ></button>
      <div
        class="modal-dialog access-control-edit-modal-dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="access-control-edit-user-title"
        tabindex="-1"
      >
        <div class="modal-header">
          <div class="modal-title-wrap">
            <h2 id="access-control-edit-user-title">Edit User</h2>
          </div>
          <button
            id="access-control-close-edit-user-button"
            type="button"
            class="modal-close"
            aria-label="Close edit user dialog"
          >
            Ã—
          </button>
        </div>

        <form id="access-control-edit-user-form" class="modal-form access-control-edit-user-form" novalidate>
          <p id="access-control-edit-user-status" class="dashboard-message user-registration-status access-control-edit-user-status">
            Update user data and click Save Changes.
          </p>

          <div class="user-registration-form access-control-edit-user-form-grid">
            <label class="user-registration-field">
              <span>Username / Email (optional)</span>
              <input
                id="access-control-edit-user-username"
                name="username"
                type="text"
                autocomplete="off"
                placeholder="Optional: user email or login"
              />
            </label>

            <label class="user-registration-field">
              <span>New Password (optional)</span>
              <input
                id="access-control-edit-user-password"
                name="password"
                type="password"
                autocomplete="new-password"
                placeholder="Leave empty to keep current password"
              />
            </label>

            <label class="user-registration-field">
              <span>Display Name</span>
              <input
                id="access-control-edit-user-display-name"
                name="displayName"
                type="text"
                maxlength="140"
                autocomplete="off"
                required
              />
            </label>

            <label class="user-registration-field">
              <span>Department</span>
              <select id="access-control-edit-user-department" name="departmentId" required>
                <option value="accounting">Accounting Department</option>
                <option value="client_service">Client Service Department</option>
                <option value="sales">Sales Department</option>
                <option value="collection">Collection Department</option>
              </select>
            </label>

            <label class="user-registration-field">
              <span>Role</span>
              <select id="access-control-edit-user-role" name="roleId" required></select>
            </label>

            <label
              class="user-registration-field user-registration-field--wide"
              id="access-control-edit-user-team-field"
              hidden
            >
              <span>Team Usernames (comma separated, for Middle Manager)</span>
              <input id="access-control-edit-user-team" name="teamUsernames" type="text" autocomplete="off" />
            </label>
          </div>

          <div class="modal-footer access-control-edit-user-footer">
            <div class="access-control-edit-user-actions">
              <button id="access-control-cancel-edit-user-button" type="button" class="btn btn-secondary">Cancel</button>
              <button id="access-control-save-user-button" type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
