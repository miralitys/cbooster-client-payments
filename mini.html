<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="dark" />
    <title>CB Payment Mini App</title>
    <style>
      :root {
        --page-bg: #0f172a;
        --card-bg: #111827;
        --field-bg: #0b1220;
        --line: #334155;
        --line-soft: #243244;
        --text: #e2e8f0;
        --muted: #94a3b8;
        --brand: #3b82f6;
        --brand-strong: #2563eb;
        --brand-glow: rgba(59, 130, 246, 0.34);
        --danger: #f87171;
        --ok: #60a5fa;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 14px;
        font-family:
          "Segoe UI",
          -apple-system,
          BlinkMacSystemFont,
          "Helvetica Neue",
          Arial,
          sans-serif;
        color: var(--text);
        background: var(--page-bg);
      }

      .shell {
        max-width: 560px;
        margin: 0 auto;
      }

      .title {
        margin: 0;
        font-size: 19px;
        font-weight: 700;
        letter-spacing: 0.01em;
      }

      .subtitle {
        margin: 4px 0 12px;
        color: var(--muted);
        font-size: 12px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      form {
        background: var(--card-bg);
        border: 1px solid var(--line);
        border-radius: 16px;
        padding: 14px 14px calc(18px + env(safe-area-inset-bottom));
      }

      .form-section {
        display: grid;
        gap: 10px;
      }

      .form-section + .form-section {
        position: relative;
        margin-top: 24px;
        padding-top: 24px;
      }

      .form-section + .form-section::before {
        content: "";
        position: absolute;
        left: 8px;
        right: 8px;
        top: 0;
        height: 1px;
        background: var(--line-soft);
      }

      .section-title {
        margin: 0;
        color: var(--muted);
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      .field {
        display: grid;
        gap: 6px;
      }

      label {
        margin: 0;
        color: var(--muted);
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      input:not([type="checkbox"]),
      textarea {
        width: 100%;
        border: 1px solid var(--line);
        border-radius: 12px;
        background: var(--field-bg);
        color: var(--text);
        min-height: 46px;
        padding: 10px 12px;
        font-size: 15px;
        outline: none;
        transition: border-color 0.16s ease, box-shadow 0.16s ease;
      }

      input:not([type="checkbox"])::placeholder,
      textarea::placeholder {
        color: #4f6178;
      }

      input:not([type="checkbox"]):focus,
      textarea:focus {
        border-color: var(--brand);
        box-shadow: 0 0 0 3px var(--brand-glow);
      }

      input.input-invalid,
      textarea.input-invalid {
        border-color: var(--danger);
        box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.2);
      }

      .field-help {
        margin: 0;
        color: var(--muted);
        font-size: 12px;
        line-height: 1.35;
      }

      .date-input-shell {
        position: relative;
      }

      .date-input-shell > input[type="text"] {
        padding-right: 44px;
      }

      .date-picker-trigger {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        width: 24px;
        height: 24px;
        border: 0;
        border-radius: 8px;
        background: transparent;
        color: var(--muted);
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .date-picker-trigger:hover {
        color: var(--text);
        background: #182234;
      }

      .date-picker-trigger svg {
        width: 18px;
        height: 18px;
        fill: currentColor;
      }

      .date-picker-proxy {
        position: absolute;
        width: 0;
        height: 0;
        opacity: 0;
        pointer-events: none;
        border: 0;
        padding: 0;
        margin: 0;
      }

      .payment-group {
        border: 1px solid var(--line-soft);
        border-radius: 14px;
        background: #0b1527;
        padding: 10px;
        display: grid;
        gap: 8px;
      }

      .payment-group__title {
        margin: 0;
        color: var(--muted);
        font-size: 12px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .payment-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }

      .toggle-card {
        margin: 0;
        border: 1px solid var(--line);
        border-radius: 12px;
        background: var(--field-bg);
        padding: 10px 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        cursor: pointer;
      }

      .toggle-copy {
        display: grid;
        gap: 4px;
      }

      .toggle-title {
        color: var(--text);
        font-size: 14px;
        font-weight: 600;
      }

      .toggle-hint {
        color: var(--muted);
        font-size: 12px;
      }

      .toggle-switch {
        position: relative;
        display: inline-flex;
        width: 44px;
        height: 24px;
        flex-shrink: 0;
      }

      .toggle-switch input {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        width: 44px;
        height: 24px;
        border-radius: 999px;
        background: #334155;
        position: relative;
        transition: background-color 0.16s ease;
      }

      .toggle-slider::after {
        content: "";
        position: absolute;
        left: 3px;
        top: 3px;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #e2e8f0;
        transition: transform 0.16s ease;
      }

      .toggle-switch input:checked + .toggle-slider {
        background: var(--brand);
      }

      .toggle-switch input:checked + .toggle-slider::after {
        transform: translateX(20px);
      }

      textarea {
        min-height: 96px;
        resize: vertical;
      }

      .attachments-card {
        position: relative;
        border: 1px solid var(--line-soft);
        border-radius: 14px;
        background: #0b1527;
        padding: 10px;
        display: grid;
        gap: 10px;
      }

      .attachments-card__title {
        margin: 0;
        color: var(--text);
        font-size: 14px;
        font-weight: 600;
      }

      .attachments-input-native {
        position: absolute;
        width: 1px;
        height: 1px;
        opacity: 0;
        pointer-events: none;
      }

      .attachments-upload-button {
        width: fit-content;
        border: 1px solid var(--line);
        border-radius: 10px;
        background: #12203a;
        color: #bfdbfe;
        font-weight: 700;
        font-size: 13px;
        padding: 9px 12px;
        cursor: pointer;
        transition: background-color 0.16s ease, border-color 0.16s ease;
      }

      .attachments-upload-button:hover {
        border-color: var(--brand);
        background: #16294a;
      }

      .attachments-upload-button:disabled {
        opacity: 0.58;
        cursor: not-allowed;
      }

      .attachments-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 2px;
      }

      .attachments-preview[hidden] {
        display: none;
      }

      .attachments-preview__item {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: 1px solid var(--line);
        border-radius: 999px;
        background: var(--field-bg);
        padding: 6px 10px;
        font-size: 12px;
        color: var(--text);
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .attachments-preview__item::before {
        content: "ðŸ“„";
        font-size: 12px;
        line-height: 1;
      }

      .attachments-preview__meta {
        color: var(--muted);
      }

      .submit-bar {
        position: sticky;
        z-index: 2;
        bottom: max(6px, env(safe-area-inset-bottom));
        margin-top: 22px;
        padding-top: 12px;
        background: linear-gradient(to bottom, rgba(17, 24, 39, 0), rgba(17, 24, 39, 0.96) 34%);
      }

      #mini-submit-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        border: 0;
        border-radius: 12px;
        background: var(--brand-strong);
        color: #ffffff;
        font-size: 15px;
        font-weight: 700;
        min-height: 46px;
        cursor: pointer;
        box-shadow: 0 10px 22px -14px rgba(37, 99, 235, 0.85);
        transition: opacity 0.16s ease;
      }

      #mini-submit-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
      }

      .button-spinner {
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.45);
        border-top-color: #ffffff;
        border-radius: 50%;
        display: none;
        animation: mini-submit-spin 0.8s linear infinite;
      }

      #mini-submit-button.is-loading .button-spinner {
        display: inline-block;
      }

      #mini-submit-button.is-loading .button-label {
        opacity: 0.92;
      }

      @keyframes mini-submit-spin {
        to {
          transform: rotate(360deg);
        }
      }

      .message {
        min-height: 20px;
        margin: 10px 2px 0;
        font-size: 13px;
      }

      .message.error {
        color: var(--danger);
      }

      .message.success {
        color: var(--ok);
      }

      .access-retry-button {
        border: 1px solid var(--line);
        border-radius: 10px;
        background: #12203a;
        color: #bfdbfe;
        font-size: 13px;
        font-weight: 700;
        line-height: 1;
        padding: 9px 12px;
        margin: 8px 2px 0;
        cursor: pointer;
        transition: background-color 0.16s ease, border-color 0.16s ease, opacity 0.16s ease;
      }

      .access-retry-button:hover {
        border-color: var(--brand);
        background: #16294a;
      }

      .access-retry-button:disabled {
        opacity: 0.58;
        cursor: not-allowed;
      }

      .access-retry-button[hidden] {
        display: none;
      }

      @media (max-width: 420px) {
        .payment-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/mini.js?v=20260221-access-retry-v1" defer></script>
  </head>
  <body>
    <main class="shell">
      <h1 class="title">New Client</h1>
      <p class="subtitle">Submissions go to moderation queue.</p>

      <form id="mini-client-form" novalidate>
        <section class="form-section" aria-labelledby="mini-section-basic">
          <h2 id="mini-section-basic" class="section-title">Basic Info</h2>

          <div class="field">
            <label for="clientName">Client Name *</label>
            <input id="clientName" name="clientName" required autocomplete="off" />
          </div>

          <div class="field">
            <label for="clientPhoneNumber">Phone</label>
            <input
              id="clientPhoneNumber"
              name="clientPhoneNumber"
              autocomplete="off"
              type="tel"
              inputmode="numeric"
              maxlength="15"
              placeholder="+1(555)123-4567"
            />
          </div>

          <div class="field">
            <label for="clientEmailAddress">Email</label>
            <input
              id="clientEmailAddress"
              name="clientEmailAddress"
              autocomplete="off"
              type="email"
              placeholder="client@example.com"
            />
          </div>

          <div class="field">
            <label for="companyName">Company *</label>
            <input id="companyName" name="companyName" required autocomplete="off" />
          </div>
        </section>

        <section class="form-section" aria-labelledby="mini-section-sales">
          <h2 id="mini-section-sales" class="section-title">Sales Info</h2>

          <div class="field">
            <label for="closedBy">Closed By *</label>
            <input id="closedBy" name="closedBy" required autocomplete="off" />
          </div>

          <div class="field">
            <label for="leadSource">Lead Source</label>
            <input id="leadSource" name="leadSource" autocomplete="off" />
          </div>

          <div class="field">
            <label for="serviceType">Service Type *</label>
            <input id="serviceType" name="serviceType" required autocomplete="off" />
          </div>
        </section>

        <section class="form-section" aria-labelledby="mini-section-contract">
          <h2 id="mini-section-contract" class="section-title">Contract</h2>

          <div class="field">
            <label for="contractTotals">Contract Totals *</label>
            <input id="contractTotals" name="contractTotals" required autocomplete="off" />
          </div>

          <div class="payment-group">
            <h3 class="payment-group__title">Payment 1</h3>

            <div class="payment-grid">
              <div class="field">
                <label for="payment1">Amount *</label>
                <input id="payment1" name="payment1" required autocomplete="off" />
              </div>

              <div class="field">
                <label for="payment1Date">Date *</label>
                <div class="date-input-shell">
                  <input id="payment1Date" name="payment1Date" type="text" placeholder="MM/DD/YYYY" required autocomplete="off" />
                  <button type="button" class="date-picker-trigger" data-date-target="payment1Date" aria-label="Pick date">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 8H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 6a1 1 0 0 0-1 1v1h16V7a1 1 0 0 0-1-1H5Z"
                      />
                    </svg>
                  </button>
                  <input type="date" class="date-picker-proxy" data-date-proxy-for="payment1Date" tabindex="-1" />
                </div>
              </div>
            </div>
          </div>

          <div class="field">
            <label for="futurePayment">Future Payment</label>
            <input id="futurePayment" name="futurePayment" autocomplete="off" />
          </div>

          <label class="toggle-card" for="afterResult">
            <div class="toggle-copy">
              <span class="toggle-title">After Result</span>
              <span class="toggle-hint">Track this client as "After Result".</span>
            </div>
            <span class="toggle-switch">
              <input id="afterResult" type="checkbox" name="afterResult" />
              <span class="toggle-slider"></span>
            </span>
          </label>
        </section>

        <section class="form-section" aria-labelledby="mini-section-extra">
          <h2 id="mini-section-extra" class="section-title">Extra</h2>

          <div class="field">
            <label for="ssn">SSN</label>
            <input
              id="ssn"
              name="ssn"
              type="password"
              autocomplete="off"
              inputmode="numeric"
              maxlength="11"
              placeholder="â€¢â€¢â€¢-â€¢â€¢-â€¢â€¢â€¢â€¢"
            />
          </div>

          <div class="field">
            <label for="identityIq">IdentityIQ</label>
            <input id="identityIq" name="identityIq" autocomplete="off" />
            <p class="field-help">IdentityIQ reference or status note (if applicable).</p>
          </div>

          <div class="field">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" placeholder="Add extra context for moderation"></textarea>
          </div>

          <div class="attachments-card">
            <h3 class="attachments-card__title">ðŸ“Ž Attachments</h3>
            <p class="field-help">Upload up to 10 files</p>
            <input id="attachments" class="attachments-input-native" name="attachments" type="file" multiple />
            <button id="attachments-upload-button" class="attachments-upload-button" type="button">Upload files</button>
            <div id="attachments-preview" class="attachments-preview" hidden></div>
          </div>
        </section>

        <div class="submit-bar">
          <button type="submit" id="mini-submit-button">
            <span class="button-label">Add Client</span>
            <span class="button-spinner" aria-hidden="true"></span>
          </button>
        </div>
      </form>

      <p id="mini-message" class="message" role="status" aria-live="polite"></p>
      <button id="mini-access-retry-button" class="access-retry-button" type="button" hidden>
        Retry access
      </button>
    </main>
  </body>
</html>
